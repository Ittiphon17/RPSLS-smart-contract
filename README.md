# RPSLS-smart-contract
### 1. **ป้องกันไม่ให้เงินถูกล็อคใน Contract**

- **`checkTimeout`** ฟังก์ชันนี้เมื่อมีผู้เล่นเข้าร่วมเกมเพียงคนเดียว ฟังก์ชันจะตรวจสอบว่าเวลาผ่านไปเกิน 120 วินาทีตั้งแต่เริ่มเกม หากเกินเวลาที่กำหนด ผู้เล่นที่เข้าร่วมสามารถถอนเงิน (1 ether) ได้ 
- **`checkTimeoutTwoPlayers`** ฟังก์ชันนี้ใช้เมื่อผู้เล่นสองคนเข้าร่วมเกมแล้ว หากเกมยังไม่ดำเนินการภายใน 120 วินาที ก็คือ ผู้เล่นคนหนึ่งยังไม่ได้เปิดเผยตัวเลือก ผู้เล่นทั้งสองสามารถถอนเงิน 1 ether ได้

### 2. **การซ่อนตัวเลือกและการทำ Commit** 

- **การทำ Commit ตัวเลือก**
ฟังก์ชัน `_makeCommit(bytes32 commitHash)` เพื่อทำ commit ตัวเลือก โดยผู้เล่นจะทำการแฮชตัวเลือกร่วมกับ random ที่สุ่ม แล้วส่งค่าแฮชที่ได้ไปยัง Contract ซึ่ง commit นี้จะถูกเก็บไว้ใน `commits` mapping
- **การแฮช**: 
  การสร้างแฮช commit ทำได้โดยการนำตัวเลือกของผู้เล่นมารวมกับค่า random ที่สุ่ม และทำการแฮชด้วยฟังก์ชัน `keccak256` ช่วยป้องกันการทำ front-running 
- **การเปิดเผยตัวเลือก**
  ฟังก์ชัน `revealChoice` จะใช้โดยผู้เล่นในการเปิดเผยตัวเลือก เพื่อให้ Contract ทำการแฮชค่าที่ได้จากการเปิดเผยและตรวจสอบว่าตรงกับ commit ที่ถูกส่งไว้ก่อนหน้านี้หรือไม่

### 3. **ส่วนที่จัดการกับความล่าช้าที่ผู้เล่นไม่ครบทั้งสองคนเสียที**
Contract จะตรวจสอบว่า หากยังไม่มีผู้เล่นครบทั้งสองคน ผู้เล่นที่เข้าร่วมแล้วสามารถถอนเงินหลังจากผ่านระยะเวลา

- **`checkTimeout`** หากมีผู้เล่นเพียงคนเดียว (`numPlayer == 1`) จะตรวจสอบว่า 120 วินาทีผ่านไปแล้วหรือไม่ ตั้งแต่ผู้เล่นคนแรกเข้าร่วม หากเกินเวลาที่กำหนด ผู้เล่นคนแรกสามารถถอนเงิน 1 ether ได้ เพื่อไม่ให้เงินถูกล็อค
- **`checkTimeoutTwoPlayers`** เมื่อมีผู้เล่นสองคน (`numPlayer == 2`) ฟังก์ชันนี้จะตรวจสอบว่า 120 วินาทีผ่านหรือไม่ หากผู้เล่นคนที่สองยังไม่ได้เปิดเผยตัวเลือกในเวลานั้น ผู้เล่นทั้งสองจะได้รับการคืนเงิน

### 4. **การ reveal และนำ choice มาตัดสินผู้ชนะ**

- **การเปิดเผยตัวเลือก** ผู้เล่นทั้งสองเปิดเผยตัวเลือกโดยใช้ฟังก์ชัน `revealChoice` สัญญาจะเก็บตัวเลือกที่เปิดเผยใน `revealedChoice` mapping หากผู้เล่นทั้งสองเปิดเผยตัวเลือกแล้ว เกมจะดำเนินการไปยังฟังก์ชัน `_checkWinnerAndPay`
  
- **การชนะ**
  ฟังก์ชัน `_checkWinnerAndPay` จะเปรียบเทียบตัวเลือกของผู้เล่นทั้งสองโดยใช้ฟังก์ชันช่วย `_winsAgainst` ซึ่งจะตรวจสอบกฎของเกม RPSLS (Rock, Paper, Scissors, Lizard, Spock) เพื่อหาผู้ชนะ 
 
- **รีเซ็ตเกม**
  หลังจากตัดสินผู้ชนะหรือหากเป็นการเสมอ ฟังก์ชัน `_resetGame` จะถูกเรียกใช้เพื่อรีเซ็ตสถานะของเกม ผู้เล่นและรางวัลจะถูกเคลียร์ และเกมสามารถเริ่มต้นใหม่ได้


